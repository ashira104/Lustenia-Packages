<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MudletPackage>
<MudletPackage version="1.001">
	<TriggerPackage>
		<TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
			<name>Check domoth status</name>
			<script>--Made by Vadi</script>
			<triggerType>0</triggerType>
			<conditonLineDelta>0</conditonLineDelta>
			<mStayOpen>0</mStayOpen>
			<mCommand></mCommand>
			<packageName></packageName>
			<mFgColor>#ff0000</mFgColor>
			<mBgColor>#ffff00</mBgColor>
			<mSoundFile></mSoundFile>
			<colorTriggerFgColor>#000000</colorTriggerFgColor>
			<colorTriggerBgColor>#000000</colorTriggerBgColor>
			<regexCodeList />
			<regexCodePropertyList />
			<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="yes" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>Ooh lala...</name>
				<script>ndborgs = {}</script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>999</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>***</string>
					<string>STATUS OF THE DOMOTH REALMS</string>
					<string>^\*+\[ STATUS OF THE DOMOTH REALMS \]\*+$</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>0</integer>
					<integer>0</integer>
					<integer>1</integer>
				</regexCodePropertyList>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Chaos/Beauty/Justice/Life</name>
					<script>selectString(" ", 2)
fg("dark_slate_gray")
replace("/")
domoth_matching = true
deselect()</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>  Chaos</string>
						<string>  Beauty</string>
						<string>  Justice</string>
						<string>  Life</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>2</integer>
						<integer>2</integer>
						<integer>2</integer>
						<integer>2</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="yes" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Start of a section</name>
					<script>selectString(" ", 2)
fg("dark_slate_gray")
replace("|")
deselect()</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>               </string>
						<string>return domoth_matching</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>2</integer>
						<integer>4</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Harmony/Knowledge/War/Death</name>
					<script>selectString(" ", 2)
fg("dark_slate_gray")
replace("\\")
domoth_matching = nil
deselect()</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>  Harmony</string>
						<string>  Knowledge</string>
						<string>  War</string>
						<string>  Death</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>2</integer>
						<integer>2</integer>
						<integer>2</integer>
						<integer>2</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Show dormancy</name>
					<script>local osdate, ostime = os.date, os.time
local secondsearliest, secondslatest = ostime() + (60*60 * matches[2]), ostime() + (60*60 * (matches[2]+1))

local starthour, endhour, startnoon, endnoon, startday, endday, currentday =
  osdate("%I", secondsearliest),
  osdate("%I", secondslatest),
  osdate("%p", secondsearliest),
  osdate("%p", secondslatest),
  osdate("%A", secondsearliest),
  osdate("%A", secondslatest),
  osdate("%A")

if selectString(matches[1], 1) &gt; 0 then
  fg("DodgerBlue")
  resetFormat()
  deselect()
end

resetFormat()
echo(string.format("  -&gt; activates from %d%s%s to %d%s%s",
  starthour,
  (startnoon == endnoon and "" or startnoon:lower()),
  (startday == endday and "" or (" on ".. startday)),
  endhour,
  endnoon:lower(),
  (currentday == endday and " today" or (" on "..endday))
))
</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>Dormancy  : (\d+) days</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Show level expire</name>
					<script>local osdate, ostime = os.date, os.time
local timeleft = tonumber(matches[2])
local secondsearliest, secondslatest = ostime() + (60*60 * matches[2]), ostime() + (60*60 * (matches[2]+1))

local starthour, endhour, startnoon, endnoon, startday, endday, currentday =
  osdate("%I", secondsearliest),
  osdate("%I", secondslatest),
  osdate("%p", secondsearliest),
  osdate("%p", secondslatest),
  osdate("%A", secondsearliest),
  osdate("%A", secondslatest),
  osdate("%A")

fg("cadet_blue")

local daytext = ""
if currentday == endday and timeleft &lt; 24 then
  daytext = " today"
elseif currentday == endday and timeleft &gt;= 24 then
  daytext = " next "..currentday
else
  daytext = " on "..endday
end


echo(string.format("  -&gt; expires from %d%s%s to %d%s%s",
  starthour,
  (startnoon == endnoon and "" or startnoon:lower()),
  (startday == endday and "" or (" on ".. startday)),
  endhour,
  endnoon:lower(),
  daytext
))
resetFormat()
deselect()</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>Time Left : (\d+) days</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>MORE</name>
					<script></script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand>more</mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>Type MORE to continue reading.</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>2</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Domoth org status</name>
					<script>if not ndb then return end

local domoth, holder = matches[2], matches[3]
if holder == "Free" or holder == "The" then return end

if ndb.isenemy(holder) then
  if selectString(domoth, 1) &gt; 0 then
    fg("red"); resetFormat(); deselect()
  end

  if selectString(holder.." controls the Throne", 1) &gt; 0 then
    fg("red"); resetFormat(); deselect()
  end
else
  if selectString(domoth, 1) &gt; 0 then
    fg("green"); resetFormat(); deselect()
  end
end

local org = ndb.getorg(holder)
if not org then
  ndb.addname(holder)
  org = "?"
end

ndborgs[org] = (ndborgs[org] or 0) + 1</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^  (\w+) + : (\w+)</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>Stop (domoth status)</name>
					<script>setTriggerStayOpen("Ooh lala...", 0)
domoth_matching = nil

echo'\n' 

local text = {}
for org,count in pairs(ndborgs) do
  text[#text+1] = string.format("%s holds %s", org,count)
end

cecho(string.format("\n&lt;white&gt;%s Domoth%s.", table.concat(text, ", "), text[#text]:sub(#text[#text]) == "1" and '' or "s"))

ndborgs = nil</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>***************************************************************************</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>3</integer>
					</regexCodePropertyList>
				</Trigger>
			</Trigger>
		</TriggerGroup>
	</TriggerPackage>
</MudletPackage>
